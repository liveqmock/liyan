<?xml version="1.0" encoding="UTF-8"?>
<ViewConfig>
  <Property name="metaData">
    <Property name="securityTag">MdTableManage</Property>
  </Property>
  <Arguments/>
  <Context/>
  <Model>
    <DataType name="querydataTypeMdDimension">
      <Property name="autoCreatePropertyDefs">false</Property>
      <PropertyDef name="id">
        <Property name="dataType">String</Property>
        <Property name="label">维度ID</Property>
      </PropertyDef>
      <PropertyDef name="tableId">
        <Property name="dataType">String</Property>
        <Property name="label">表结构ID</Property>
      </PropertyDef>
      <PropertyDef name="tableName">
        <Property name="dataType">String</Property>
        <Property name="label">表名</Property>
      </PropertyDef>
      <PropertyDef name="dimenName">
        <Property name="dataType">String</Property>
        <Property name="label">维度名称</Property>
      </PropertyDef>
      <PropertyDef name="dimenDesc">
        <Property name="dataType">String</Property>
        <Property name="label">维度描述</Property>
      </PropertyDef>
      <PropertyDef name="dimenType">
        <Property name="dataType">String</Property>
        <Property name="label">维度类型</Property>
        <Property name="mapping">
          <Property name="mapValues">${dorado.getDataProvider(&quot;coderCreate#getDict&quot;).getResult(&quot;DIMEN_TYPE&quot;)}</Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="isDimenDefault">
        <Property name="dataType">String</Property>
        <Property name="label">是否默认维度</Property>
        <Property name="mapping">
          <Property name="mapValues">${dorado.getDataProvider(&quot;coderCreate#getDict&quot;).getResult(&quot;COMM_Y_N&quot;)}</Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="status">
        <Property name="dataType">String</Property>
        <Property name="label">有效状态</Property>
        <Property name="mapping">
          <Property name="mapValues">${dorado.getDataProvider(&quot;coderCreate#getDict&quot;).getResult(&quot;COMM_STATUS&quot;)}</Property>
        </Property>
      </PropertyDef>
      <PropertyDef name="crtOrgCode">
        <Property name="dataType">String</Property>
        <Property name="label">创建机构</Property>
      </PropertyDef>
      <PropertyDef name="crtUserCode">
        <Property name="dataType">String</Property>
        <Property name="label">创建人</Property>
      </PropertyDef>
      <PropertyDef name="crtDate">
        <Property name="dataType">Date</Property>
        <Property name="label">创建日期</Property>
      </PropertyDef>
      <PropertyDef name="updOrgCode">
        <Property name="dataType">String</Property>
        <Property name="label">修改机构</Property>
      </PropertyDef>
      <PropertyDef name="updDate">
        <Property name="dataType">Date</Property>
        <Property name="label">修改日期</Property>
      </PropertyDef>
      <PropertyDef name="updUserCode">
        <Property name="dataType">String</Property>
        <Property name="label">修改人</Property>
      </PropertyDef>
    </DataType>
  </Model>
  <View>
    <DataSet id="dataSetMdDimension">
      <ClientEvent name="onReady">var lookStyle=&quot;${request.getParameter('lookStyle')}&quot;;
var mdId=&quot;${request.getParameter('mdId')}&quot;;
var tableId=&quot;${request.getParameter('tableId')}&quot;;
if(lookStyle ==&quot;look&quot;){
	parm={tableId:mdId,status:&quot;1&quot;};
	self.set(&quot;parameter&quot;, parm).flushAsync();
	view.get(&quot;#queryFieldSet&quot;).set(&quot;visible&quot;,false);
	view.get(&quot;#queryFieldSet&quot;).set(&quot;hideMode&quot;,&quot;display&quot;);
}else if(tableId != &quot;&quot;){
	parm={tableId:tableId,status:&quot;1&quot;};
	self.set(&quot;parameter&quot;, parm).flushAsync();
}
</ClientEvent>
      <Property name="dataProvider">mdDimensionAction#findMdDimensions</Property>
      <Property name="dataType">[dataTypeMdDimension]</Property>
      <Property name="pageSize">${sys.getLong(&quot;mdf.default.pagesize&quot;)}</Property>
    </DataSet>
    <DataSet id="dataSetMdDimenField">
      <Property name="dataProvider">mdDimenFieldAction#findMdDimenFields</Property>
      <Property name="dataType">[dataTypeMdDimenField]</Property>
      <Property name="pageSize">${sys.getLong(&quot;mdf.default.pagesize&quot;)}</Property>
      <Property name="loadMode">manual</Property>
    </DataSet>
    <DataSet id="querydataSetMdDimension">
      <ClientEvent name="onReady">self.insert({});</ClientEvent>
      <Property name="dataType">[querydataTypeMdDimension]</Property>
    </DataSet>
    <Container>
      <FieldSet id="queryFieldSet" layoutConstraint="top">
        <Property name="caption">查询条件</Property>
        <Property name="collapsed">false</Property>
        <Buttons>
          <Button>
            <ClientEvent name="onClick">
view.get(&quot;#dataSetMdDimension&quot;).set(&quot;parameter&quot;, view.get(&quot;#querydataSetMdDimension&quot;).getData(&quot;#&quot;)).flushAsync();</ClientEvent>
            <Property name="caption">查询</Property>
            <Property name="icon">url(>skin>common/icons.gif) -40px -100px</Property>
          </Button>
          <Button>
            <ClientEvent name="onClick">view.set(&quot;#querydataSetMdDimension.data&quot;,{});
</ClientEvent>
            <Property name="icon">url(>skin>common/icons.gif) -280px -220px</Property>
            <Property name="caption">重置</Property>
          </Button>
        </Buttons>
        <Children>
          <AutoForm id="autoFormMdDimensionQuery" layoutConstraint="center">
            <Property name="dataSet">querydataSetMdDimension</Property>
            <Property name="dataType">dataTypeMdDimension</Property>
            <Property name="labelWidth">80</Property>
            <AutoFormElement>
              <Property name="name">tableName</Property>
              <Property name="property">tableName</Property>
              <Property name="trigger">customDropDownMdTableM</Property>
              <Property name="labelWidth">80</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">dimenName</Property>
              <Property name="property">dimenName</Property>
              <Property name="trigger">triggerClear</Property>
              <Editor>
                <TextEditor/>
              </Editor>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">dimenType</Property>
              <Property name="property">dimenType</Property>
              <Editor/>
            </AutoFormElement>
            <AutoFormElement>
              <Property name="name">status</Property>
              <Property name="property">status</Property>
              <Editor/>
            </AutoFormElement>
          </AutoForm>
        </Children>
      </FieldSet>
      <ToolBar id="toolBarMdDimension" layoutConstraint="top">
        <Property name="tags">tags_toolbar</Property>
        <ToolBarButton id="addButton">
          <ClientEvent name="onClick">var tableId=&quot;${request.getParameter('tableId')}&quot;;
var tableName=&quot;${request.getParameter('tableName')}&quot;;
var dataSet = view.get(&quot;#dataSetMdDimension&quot;);
var dataSetDimenField = view.get(&quot;#dataSetMdDimenField&quot;);
var dialog = view.get(&quot;#addMdDimensionDialog&quot;);
	dataSet.set(&quot;readOnly&quot;,false);
	view.get(&quot;#dataSetMdDimension.data&quot;).insert();
	var entity = dataSet.getData(&quot;#&quot;);
		entity.set(&quot;tableId&quot;,tableId);
		entity.set(&quot;tableName&quot;,tableName);
		entity.set(&quot;status&quot;,&quot;1&quot;);
var dimenId = dataSet.getData(&quot;#&quot;).get(&quot;id&quot;);
if(dimenId==&quot;&quot;||dimenId==undefined){
	parm={dimenId:&quot;1&quot;};
}else{
	parm={dimenId:dimenId};
}
dataSetDimenField.set(&quot;parameter&quot;, parm).flushAsync();
	dialog.show();</ClientEvent>
          <Property name="icon">url(>skin>common/icons.gif) -120px -0px</Property>
          <Property name="caption">添加</Property>
        </ToolBarButton>
        <ToolBarButton id="updateButton">
          <ClientEvent name="onClick">var dataSet = view.get(&quot;#dataSetMdDimension&quot;);
var dataSetDimenField = view.get(&quot;#dataSetMdDimenField&quot;);
var dialog = view.get(&quot;#updateMdDimensionDialog&quot;);
var entitys = dataSet.getData();
var selection = view.get(&quot;#dataGridMdDimension&quot;).get(&quot;selection&quot;);

if(selection.length==0){
	dorado.MessageBox.alert(&quot;请选择记录！&quot;);
}else if(selection.length>1){
	dorado.MessageBox.alert(&quot;只能选择一条记录查看修改！&quot;);
}else if (selection.length == 1){
	dataSet.getData().setCurrent(selection[0]);
	var dimenId = dataSet.getData(&quot;#&quot;).get(&quot;id&quot;);
	if(dimenId==&quot;&quot;||dimenId==undefined){
		parm={dimenId:&quot;1&quot;};
	}else{
		parm={dimenId:dimenId};
	}
	dataSetDimenField.set(&quot;parameter&quot;, parm).flushAsync();
	dialog.show();
	dataSet.set(&quot;readOnly&quot;,false);
}       </ClientEvent>
          <Property name="caption">修改</Property>
          <Property name="icon">url(>skin>common/icons.gif) -200px -0px</Property>
        </ToolBarButton>
        <ToolBarButton id="delButton">
          <ClientEvent name="onClick">var dataSet = view.get(&quot;#dataSetMdDimension&quot;);
var entitys = dataSet.getData();
var selection = view.get(&quot;#dataGridMdDimension&quot;).get(&quot;selection&quot;);
var action = view.get(&quot;#saveMdDimensionsAction&quot;);

if(selection.length==0){
	dorado.MessageBox.alert(&quot;请选择记录！&quot;);
}else if (selection.length != 0) {
	dorado.MessageBox.confirm(&quot;是否删除？&quot;, function(){
			jQuery.each(selection,function(i,item){
			entitys.remove(item);
		});
		action.execute();
	});
}
 </ClientEvent>
          <Property name="caption">删除</Property>
          <Property name="icon">url(>skin>common/icons.gif) -140px -0px</Property>
        </ToolBarButton>
        <ToolBarButton id="lookButton">
          <ClientEvent name="onClick">var dataSet = view.get(&quot;#dataSetMdDimension&quot;);
var dataSetDimenField = view.get(&quot;#dataSetMdDimenField&quot;);
var dialog = view.get(&quot;#lookMdDimensionDialog&quot;);
var entitys = dataSet.getData();
var found = false;
var selection = view.get(&quot;#dataGridMdDimension&quot;).get(&quot;selection&quot;);

if(selection.length==0){
	dorado.MessageBox.alert(&quot;请选择记录！&quot;);
}
else if(selection.length>1)
{
	dorado.MessageBox.alert(&quot;只能查看一条记录！&quot;);
}
else if (selection.length == 1) {
	dataSet.getData().setCurrent(selection[0]);
	var dimenId = dataSet.getData(&quot;#&quot;).get(&quot;id&quot;);
	if(dimenId==&quot;&quot;||dimenId==undefined){
		parm={dimenId:&quot;1&quot;};
	}else{
		parm={dimenId:dimenId};
	}
	dataSetDimenField.set(&quot;parameter&quot;, parm).flushAsync();
	dialog.show();
	dataSet.set(&quot;readOnly&quot;,true);
}</ClientEvent>
          <Property name="caption">查看</Property>
          <Property name="icon">url(>skin>common/icons.gif) -120px -120px</Property>
        </ToolBarButton>
      </ToolBar>
      <Container>
        <DataGrid id="dataGridMdDimension" layoutConstraint="center">
          <ClientEvent name="onDataRowClick">/*var newSelection = [];
var selection = self.get(&quot;selection&quot;);
var entity = view.get(&quot;#dataSetMdTable&quot;).getData(&quot;#&quot;);
var found = false;
selection.each(function(data){
	if (data.get(&quot;id&quot;) == entity.get(&quot;id&quot;)) {
		found = true;
	}else{
		newSelection.push(data);
	}
});

if (!found) {
	newSelection.push(entity);
}
self.set(&quot;selection&quot;, newSelection);*/</ClientEvent>
          <ClientEvent name="onSelectionChange">
if (arg.added) 
{
 view.get(&quot;#dataSetMdDimension&quot;).getData().setCurrent(arg.added[0])
}
</ClientEvent>
          <Property name="dataSet">dataSetMdDimension</Property>
          <Property name="selectionMode">multiRows</Property>
          <Property name="readOnly">true</Property>
          <Property name="dataType">dataTypeMdDimension</Property>
          <Property name="rowHeight">26</Property>
          <Property name="height">100%</Property>
          <Property name="width">100%</Property>
          <Property name="highlightCurrentRow">false</Property>
          <RowNumColumn/>
          <RowSelectorColumn/>
          <DataColumn>
            <Property name="property">tableName</Property>
            <Property name="name">tableName</Property>
          </DataColumn>
          <DataColumn name="dimenName">
            <Property name="property">dimenName</Property>
          </DataColumn>
          <DataColumn name="dimenDesc">
            <Property name="property">dimenDesc</Property>
            <Property name="width">200</Property>
          </DataColumn>
          <DataColumn name="dimenType">
            <Property name="property">dimenType</Property>
          </DataColumn>
          <DataColumn name="isDimenDefault">
            <Property name="property">isDimenDefault</Property>
          </DataColumn>
          <DataColumn name="status">
            <Property name="property">status</Property>
          </DataColumn>
        </DataGrid>
      </Container>
      <ToolBar layoutConstraint="bottom">
        <DataPilot>
          <Property name="dataSet">dataSetMdDimension</Property>
          <Property name="itemCodes">pages</Property>
        </DataPilot>
      </ToolBar>
    </Container>
    <UpdateAction id="saveMdDimensionsAction">
      <Property name="executingMessage">正在处理...</Property>
      <Property name="dataResolver">mdDimensionAction#saveMdDimensions</Property>
      <Property name="modal">false</Property>
      <Property name="successMessage">操作成功！</Property>
      <UpdateItem>
        <Property name="dataSet">dataSetMdDimension</Property>
      </UpdateItem>
    </UpdateAction>
    <UpdateAction id="saveMdDimenFieldsAction">
      <Property name="executingMessage">正在处理...</Property>
      <Property name="dataResolver">mdDimenFieldAction#saveMdDimenFields</Property>
      <UpdateItem>
        <Property name="dataSet">dataSetMdDimenField</Property>
      </UpdateItem>
    </UpdateAction>
    <Dialog id="addMdDimensionDialog">
      <ClientEvent name="onClose">view.get(&quot;#dataSetMdDimension&quot;).getData().cancel();
view.get(&quot;#addMdDimensionDialog&quot;).hide();</ClientEvent>
      <Property name="caption">维度新增</Property>
      <Property name="center">true</Property>
      <Property name="border">normal</Property>
      <Property name="minimizeable">true</Property>
      <Property name="maximizeable">true</Property>
      <Property name="modal">true</Property>
      <Property name="width">100%</Property>
      <Property name="height">100%</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">var action = view.get(&quot;#saveMdDimensionsAction&quot;);
var actionDimenField = view.get(&quot;#saveMdDimenFieldsAction&quot;);
var dialog = view.get(&quot;#addMdDimensionDialog&quot;);
var dataSetDimenField = view.get(&quot;#dataSetMdDimenField&quot;);
if(dataSetDimenField.getData().entityCount>0){
	action.execute(function(){
		var dimenId = view.get(&quot;#dataSetMdDimension&quot;).getData(&quot;#&quot;).get(&quot;id&quot;);
		var entityDimenFieldList = view.get(&quot;#dataSetMdDimenField&quot;).getData()
		entityDimenFieldList.each(function(entity){
				entity.set(&quot;dimenId&quot;,dimenId);
			});
		actionDimenField.execute(function(){
			dialog.hide();
			action.set(&quot;successMessage&quot;,&quot;操作成功&quot;);
		});
	});
}else{
	dorado.MessageBox.alert(&quot;请添加维度字段信息！&quot;);
}
	</ClientEvent>
          <Property name="caption">确定</Property>
          <Property name="icon">url(>skin>common/icons.gif) -20px -0px</Property>
        </Button>
        <Button>
          <ClientEvent name="onClick">view.get(&quot;#dataSetMdDimension&quot;).getData().cancel();
view.get(&quot;#dataSetMdDimenField&quot;).getData().cancel();
view.get(&quot;#addMdDimensionDialog&quot;).hide();		  </ClientEvent>
          <Property name="caption">取消</Property>
          <Property name="icon">url(>skin>common/icons.gif) -180px -160px</Property>
        </Button>
      </Buttons>
      <Children>
        <Container>
          <Property name="contentOverflow">hidden</Property>
          <Property name="contentOverflowY">auto</Property>
          <FieldSet layoutConstraint="top">
            <Property name="caption">维度基本信息</Property>
            <Buttons/>
            <Children>
              <AutoForm id="addAutoFormMdDimension">
                <Property name="dataType">dataTypeMdDimension</Property>
                <Property name="dataSet">dataSetMdDimension</Property>
                <Property name="labelAlign">right</Property>
                <Property name="hideMode">visibility</Property>
                <AutoFormElement>
                  <Property name="name">tableName</Property>
                  <Property name="property">tableName</Property>
                  <Property name="trigger">customDropDownMdTableM</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <ClientEvent name="onBlur">var entity = view.get(&quot;#dataSetMdDimension&quot;).getData(&quot;#&quot;);
entity.set(&quot;dimenName&quot;,entity._propertyDefs._keyMap.dimenType._mappingIndex[entity.get(&quot;dimenType&quot;)]);</ClientEvent>
                  <Property name="name">dimenType</Property>
                  <Property name="property">dimenType</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">dimenName</Property>
                  <Property name="property">dimenName</Property>
                  <Property name="labelWidth">120</Property>
                  <Property name="readOnly">false</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">dimenDesc</Property>
                  <Property name="property">dimenDesc</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">isDimenDefault</Property>
                  <Property name="property">isDimenDefault</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">status</Property>
                  <Property name="property">status</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor/>
                </AutoFormElement>
              </AutoForm>
            </Children>
          </FieldSet>
          <FieldSet layoutConstraint="center">
            <Property name="caption">维度字段列表</Property>
            <Buttons/>
            <Children>
              <ToolBar>
                <ToolBarButton>
                  <ClientEvent name="onClick">var iframe = view.get(&quot;#fieldSelectIFrame&quot;);
var entityDimension = view.get(&quot;#dataSetMdDimension&quot;).getData(&quot;#&quot;);
var tableId = entityDimension.get(&quot;tableId&quot;);
var dimenType = entityDimension.get(&quot;dimenType&quot;);
var dataSetDimenField = view.get(&quot;#dataSetMdDimenField&quot;);
var dialog = view.get(&quot;#fieldSelectDialog&quot;);
var ajaxAction = view.get(&quot;#findDimenFieldIds&quot;);
var entityDimenFields = dataSetDimenField.getData();
if(entityDimension.get(&quot;tableId&quot;)==undefined){
	dorado.MessageBox.alert(&quot;请先填写表维度信息&quot;);	
}else if(entityDimension.get(&quot;dimenType&quot;) == undefined){
	dorado.MessageBox.alert(&quot;请先填写表维度类型&quot;);	
}else{
	parm={tableId:tableId,dimenType:dimenType}
	ajaxAction.set(&quot;parameter&quot;,parm).execute(function(result){
		var dimenFieldIds=&quot;&quot;;//定义一个id串。
		if(!entityDimenFields.isEmpty()){
				entityDimenFields.each(function(entity){
				dimenFieldIds=dimenFieldIds+entity.get(&quot;fieldId&quot;)+&quot;,&quot;;
			});
			dimenFieldIds = dimenFieldIds + result;
		}else{
			dimenFieldIds = result;
		}
		var path = &quot;${request.contextPath}/com/innofi/component/metadata/field/view/MdFieldForDimen.d?tableId=&quot;+entityDimension.get(&quot;tableId&quot;)+&quot;&amp;dimenFieldIds=&quot;+dimenFieldIds+&quot;&amp;randomId=&quot;+Math.random();
		iframe.set(&quot;path&quot;,path);
		dialog.show();
	});
	}</ClientEvent>
                  <Property name="caption">添加</Property>
                  <Property name="icon">url(>skin>common/icons.gif) -120px -0px</Property>
                </ToolBarButton>
                <ToolBarButton>
                  <ClientEvent name="onClick">var dataSet = view.get(&quot;#dataSetMdDimenField&quot;);
var entitys = dataSet.getData();
var selection = view.get(&quot;#dimenFieldDataGrid&quot;).get(&quot;selection&quot;);

if(selection.length==0){
	dorado.MessageBox.alert(&quot;请选择记录！&quot;);
}else if (selection.length != 0) {
	dorado.MessageBox.confirm(&quot;是否删除？&quot;, function(){
			jQuery.each(selection,function(i,item){
			entitys.remove(item);
		});
	});
}</ClientEvent>
                  <Property name="caption">删除</Property>
                  <Property name="icon">url(>skin>common/icons.gif) -140px -0px</Property>
                </ToolBarButton>
              </ToolBar>
              <DataGrid id="dimenFieldDataGrid">
                <Property name="dataSet">dataSetMdDimenField</Property>
                <Property name="dataType">dataTypeMdDimenField</Property>
                <Property name="selectionMode">multiRows</Property>
                <Property name="readOnly">true</Property>
                <RowNumColumn/>
                <RowSelectorColumn/>
                <DataColumn name="fieldName">
                  <Property name="property">fieldName</Property>
                </DataColumn>
                <DataColumn name="fieldSeq">
                  <Property name="property">fieldSeq</Property>
                </DataColumn>
                <DataColumn name="status">
                  <Property name="property">status</Property>
                </DataColumn>
              </DataGrid>
              <ToolBar layoutConstraint="bottom">
                <DataPilot>
                  <Property name="dataSet">dataSetMdDimenField</Property>
                  <Property name="itemCodes">pages</Property>
                </DataPilot>
              </ToolBar>
            </Children>
          </FieldSet>
        </Container>
      </Children>
      <Tools/>
    </Dialog>
    <Dialog id="updateMdDimensionDialog">
      <ClientEvent name="onClose">view.get(&quot;#dataSetMdDimension&quot;).getData().cancel();
view.get(&quot;#updateMdDimensionDialog&quot;).hide();</ClientEvent>
      <Property name="caption">信息编辑</Property>
      <Property name="center">true</Property>
      <Property name="border">normal</Property>
      <Property name="minimizeable">true</Property>
      <Property name="maximizeable">true</Property>
      <Property name="modal">true</Property>
      <Property name="width">100%</Property>
      <Property name="height">100%</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">var action = view.get(&quot;#saveMdDimensionsAction&quot;);
var actionDimenField = view.get(&quot;#saveMdDimenFieldsAction&quot;);
var dialog = view.get(&quot;#updateMdDimensionDialog&quot;);
var dsMdDimension = view.get(&quot;#dataSetMdDimension&quot;);
var dataSetDimenField = view.get(&quot;#dataSetMdDimenField&quot;);
var dimensionEntity = dsMdDimension.getData(&quot;#&quot;);
var dimenId = dimensionEntity.get(&quot;id&quot;);
var entityCount = view.get(&quot;#dataSetMdDimenField&quot;).getData().entityCount;

if(dataSetDimenField.getData().entityCount>0){
	var entityDimenFieldList = view.get(&quot;#dataSetMdDimenField&quot;).getData()
	var newEntity = false;
		entityDimenFieldList.each(function(entity){

			if(entity.state == 1){
				entity.set(&quot;dimenId&quot;,dimenId);
				newEntity = true;
			}else if(entity.state == 2||entity.state == 3){
				newEntity = true;
			}
		});
	if(dimensionEntity.state == 2&amp;&amp;newEntity){
		action.execute(function(){
			actionDimenField.execute(function(){
				dialog.hide();
				action.set(&quot;successMessage&quot;,&quot;操作成功&quot;);
			});
		});
	}else if(dimensionEntity.state == 2&amp;&amp;!newEntity){
		action.execute(function(){
			dialog.hide();
			action.set(&quot;successMessage&quot;,&quot;操作成功&quot;);
		});
	}else if(dimensionEntity.state == 0&amp;&amp;newEntity){
		actionDimenField.execute(function(){
			dialog.hide();
			actionDimenField.set(&quot;successMessage&quot;,&quot;操作成功&quot;);
		});
	}else{
		actionDimenField.execute(function(){
			dialog.hide();
			actionDimenField.set(&quot;successMessage&quot;,&quot;操作成功&quot;);
		});
	}
}else{
	dorado.MessageBox.alert(&quot;请添加维度字段信息&quot;);
}
</ClientEvent>
          <Property name="caption">确定</Property>
          <Property name="icon">url(>skin>common/icons.gif) -20px -0px</Property>
        </Button>
        <Button>
          <ClientEvent name="onClick">view.get(&quot;#dataSetMdDimension&quot;).getData().cancel();
view.get(&quot;#updateMdDimensionDialog&quot;).hide();
              	
		  </ClientEvent>
          <Property name="caption">取消</Property>
          <Property name="icon">url(>skin>common/icons.gif) -180px -160px</Property>
        </Button>
      </Buttons>
      <Children>
        <Container>
          <Property name="contentOverflow">hidden</Property>
          <Property name="contentOverflowY">auto</Property>
          <FieldSet layoutConstraint="top">
            <Property name="caption">维度基本信息</Property>
            <Buttons/>
            <Children>
              <AutoForm id="autoFormMdDimension">
                <Property name="dataType">dataTypeMdDimension</Property>
                <Property name="dataSet">dataSetMdDimension</Property>
                <Property name="labelAlign">right</Property>
                <Property name="hideMode">visibility</Property>
                <AutoFormElement>
                  <Property name="name">tableName</Property>
                  <Property name="property">tableName</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">dimenType</Property>
                  <Property name="property">dimenType</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">dimenName</Property>
                  <Property name="property">dimenName</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">dimenDesc</Property>
                  <Property name="property">dimenDesc</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">isDimenDefault</Property>
                  <Property name="property">isDimenDefault</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor/>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">status</Property>
                  <Property name="property">status</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor/>
                </AutoFormElement>
              </AutoForm>
            </Children>
          </FieldSet>
          <FieldSet layoutConstraint="center">
            <Property name="caption">维度字段列表</Property>
            <Buttons/>
            <Children>
              <ToolBar>
                <ToolBarButton>
                  <ClientEvent name="onClick">var iframe = view.get(&quot;#fieldSelectIFrame&quot;);
var entityDimension = view.get(&quot;#dataSetMdDimension&quot;).getData(&quot;#&quot;);
var tableId = entityDimension.get(&quot;tableId&quot;);
var ajaxAction = view.get(&quot;#findDimenFieldIds&quot;);
var dimenType = entityDimension.get(&quot;dimenType&quot;);
var dataSetDimenField = view.get(&quot;#dataSetMdDimenField&quot;);
var dialog = view.get(&quot;#fieldSelectDialog&quot;);
var entityDimenFields = dataSetDimenField.getData();
if(entityDimension.get(&quot;tableId&quot;)==undefined){
	dorado.MessageBox.alert(&quot;请先填写表维度信息&quot;);	
}else if(entityDimension.get(&quot;dimenType&quot;) == undefined){
	dorado.MessageBox.alert(&quot;请先填写表维度类型&quot;);	
}else{
	parm={tableId:tableId,dimenType:dimenType}
	ajaxAction.set(&quot;parameter&quot;,parm).execute(function(result){
		var dimenFieldIds=&quot;&quot;;//定义一个id串。
			if(!entityDimenFields.isEmpty()){
					entityDimenFields.each(function(entity){
					dimenFieldIds=dimenFieldIds+entity.get(&quot;fieldId&quot;)+&quot;,&quot;;
				});
				dimenFieldIds=dimenFieldIds.substring(0,dimenFieldIds.length-1);
				dimenFieldIds = dimenFieldIds + result;
			}else{
				dimenFieldIds = result;
			}
		var path = &quot;${request.contextPath}/com/innofi/component/metadata/field/view/MdFieldForDimen.d?tableId=&quot;+entityDimension.get(&quot;tableId&quot;)+&quot;&amp;dimenFieldIds=&quot;+dimenFieldIds+&quot;&amp;randomId=&quot;+Math.random();
		iframe.set(&quot;path&quot;,path);
		dialog.show();
	});
}</ClientEvent>
                  <Property name="caption">添加</Property>
                  <Property name="icon">url(>skin>common/icons.gif) -120px -0px</Property>
                </ToolBarButton>
                <ToolBarButton>
                  <ClientEvent name="onClick">var dataSet = view.get(&quot;#dataSetMdDimenField&quot;);
var entitys = dataSet.getData();
var selection = view.get(&quot;#updateDimenFieldDataGrid&quot;).get(&quot;selection&quot;);

if(selection.length==0){
	dorado.MessageBox.alert(&quot;请选择记录！&quot;);
}else if (selection.length != 0) {
	dorado.MessageBox.confirm(&quot;是否删除？&quot;, function(){
			jQuery.each(selection,function(i,item){
			entitys.remove(item);
		});
	});
}</ClientEvent>
                  <Property name="caption">删除</Property>
                  <Property name="icon">url(>skin>common/icons.gif) -140px -0px</Property>
                </ToolBarButton>
              </ToolBar>
              <DataGrid id="updateDimenFieldDataGrid">
                <Property name="dataSet">dataSetMdDimenField</Property>
                <Property name="dataType">dataTypeMdDimenField</Property>
                <Property name="selectionMode">multiRows</Property>
                <Property name="readOnly">true</Property>
                <RowNumColumn/>
                <RowSelectorColumn/>
                <DataColumn name="fieldName">
                  <Property name="property">fieldName</Property>
                </DataColumn>
                <DataColumn name="fieldSeq">
                  <Property name="property">fieldSeq</Property>
                </DataColumn>
                <DataColumn name="status">
                  <Property name="property">status</Property>
                </DataColumn>
              </DataGrid>
              <ToolBar layoutConstraint="bottom">
                <DataPilot>
                  <Property name="dataSet">dataSetMdDimenField</Property>
                  <Property name="itemCodes">pages</Property>
                </DataPilot>
              </ToolBar>
            </Children>
          </FieldSet>
        </Container>
      </Children>
      <Tools/>
    </Dialog>
    <Dialog id="lookMdDimensionDialog">
      <ClientEvent name="onClose">view.get(&quot;#lookMdDimensionDialog&quot;).hide();     </ClientEvent>
      <Property name="caption">信息查看</Property>
      <Property name="center">true</Property>
      <Property name="border">normal</Property>
      <Property name="minimizeable">true</Property>
      <Property name="maximizeable">true</Property>
      <Property name="modal">true</Property>
      <Property name="height">100%</Property>
      <Property name="width">100%</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">view.get(&quot;#lookMdDimensionDialog&quot;).hide();</ClientEvent>
          <Property name="caption">关闭</Property>
          <Property name="icon">url(>skin>common/icons.gif) -40px -0px</Property>
        </Button>
      </Buttons>
      <Children>
        <Container>
          <Property name="contentOverflow">hidden</Property>
          <Property name="contentOverflowY">auto</Property>
          <FieldSet layoutConstraint="top">
            <Property name="caption">维度基本信息</Property>
            <Buttons/>
            <Children>
              <AutoForm id="lookFormMdDimension">
                <Property name="dataType">dataTypeMdDimension</Property>
                <Property name="dataSet">dataSetMdDimension</Property>
                <Property name="labelAlign">right</Property>
                <Property name="hideMode">visibility</Property>
                <AutoFormElement>
                  <Property name="name">tableName</Property>
                  <Property name="property">tableName</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">dimenType</Property>
                  <Property name="property">dimenType</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">dimenName</Property>
                  <Property name="property">dimenName</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">dimenDesc</Property>
                  <Property name="property">dimenDesc</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">isDimenDefault</Property>
                  <Property name="property">isDimenDefault</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
                <AutoFormElement>
                  <Property name="name">status</Property>
                  <Property name="property">status</Property>
                  <Property name="labelWidth">120</Property>
                  <Editor>
                    <TextEditor/>
                  </Editor>
                </AutoFormElement>
              </AutoForm>
            </Children>
          </FieldSet>
          <FieldSet layoutConstraint="center">
            <Property name="caption">维度字段列表</Property>
            <Buttons/>
            <Children>
              <DataGrid id="lookDimenFieldDataGrid">
                <Property name="dataSet">dataSetMdDimenField</Property>
                <Property name="dataType">dataTypeMdDimenField</Property>
                <Property name="selectionMode">none</Property>
                <Property name="readOnly">true</Property>
                <Property name="highlightCurrentRow">false</Property>
                <RowNumColumn/>
                <DataColumn name="fieldName">
                  <Property name="property">fieldName</Property>
                </DataColumn>
                <DataColumn name="fieldSeq">
                  <Property name="property">fieldSeq</Property>
                </DataColumn>
                <DataColumn name="status">
                  <Property name="property">status</Property>
                </DataColumn>
              </DataGrid>
              <ToolBar layoutConstraint="bottom">
                <DataPilot>
                  <Property name="dataSet">dataSetMdDimenField</Property>
                  <Property name="itemCodes">pages</Property>
                </DataPilot>
              </ToolBar>
            </Children>
          </FieldSet>
        </Container>
      </Children>
      <Tools/>
    </Dialog>
    <CustomDropDown id="customDropDownMdTableM">
      <ClientEvent name="onClose">if(arg.selectedValue){
	var oldEntity = new dorado.Entity();
	oldEntity.fromJSON(JSON.parse(arg.selectedValue));
	var dataSet=self.get(&quot;editor&quot;).get(&quot;parent&quot;).get(&quot;dataSet&quot;);
	
	var entity = dataSet.getData(&quot;#&quot;) ;
	entity.set(&quot;tableId&quot;,oldEntity.get(&quot;id&quot;));
	entity.set(&quot;tableName&quot;,oldEntity.get(&quot;tableName&quot;));

		
}
arg.selectedValue = undefined;
return false;</ClientEvent>
      <Property name="autoOpen">true</Property>
      <Property name="editable">true</Property>
      <Property name="height">300</Property>
      <IFrame>
        <Property name="path">${request.contextPath}/com/innofi/module/commons/view/dropdown/MdTableSelect.d?status=1&amp;dropdown=customDropDownMdTableM</Property>
      </IFrame>
    </CustomDropDown>
    <Dialog id="fieldSelectDialog">
      <Property name="center">true</Property>
      <Property name="height">100%</Property>
      <Property name="modal">true</Property>
      <Property name="maximizeable">true</Property>
      <Property name="minimizeable">true</Property>
      <Property name="width">100%</Property>
      <Property name="caption">字段选择</Property>
      <Buttons>
        <Button>
          <ClientEvent name="onClick">view.get(&quot;#fieldSelectDialog&quot;).hide();</ClientEvent>
          <Property name="caption">关闭</Property>
          <Property name="icon">url(>skin>common/icons.gif) -40px -0px</Property>
        </Button>
      </Buttons>
      <Children>
        <IFrame id="fieldSelectIFrame"/>
      </Children>
      <Tools/>
    </Dialog>
    <AjaxAction id="findDimenFieldIds">
      <Property name="service">mdDimensionAction#findDimenFieldIds</Property>
    </AjaxAction>
  </View>
</ViewConfig>
